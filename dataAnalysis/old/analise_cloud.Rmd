---
title: "Análise de dados- Cloud"
author: "Marisangila Alves"
date: "08/14/2021"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(dplyr)
library(ggplot2)
library(plyr)
```

```{r echo=FALSE, message=FALSE}
# alpha 1
server_use1 <- data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Server_Use', col_names=TRUE))
rate_admission1 <- data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Rate_Admission', col_names=TRUE))
scattering_optic1 <- data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Scattering_Optic', col_names=TRUE))
scattering_wireless1 <- data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Scattering_Wireless', col_names=TRUE))
load_links_optic1 <- data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Load_Links_Optic', col_names=TRUE))
load_links_wireless1 <- data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Load_Links_Wireless', col_names=TRUE))
path_Realloc1 = data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Paths_Reallocation', col_names=TRUE))
host_Realloc1 = data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Hosts_Reallocation', col_names=TRUE))

poisson1 = data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Poisson', col_names=TRUE))
zipf1 = data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Zipf', col_names=TRUE))
times1 <- read.table("../dataAnalysis/data/instance_zipf080.dat", header = TRUE)

# alpha 0.5
server_use05 <- data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Server_Use', col_names=TRUE))
rate_admission05 <- data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Rate_Admission', col_names=TRUE))
scattering_optic05 <- data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Scattering_Optic', col_names=TRUE))
scattering_wireless05 <- data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Scattering_Wireless', col_names=TRUE))
load_links_optic05 <- data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Load_Links_Optic', col_names=TRUE))
load_links_wireless05 <- data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Load_Links_Wireless', col_names=TRUE))
path_Realloc05 = data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Paths_Reallocation', col_names=TRUE))
host_Realloc05 = data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Hosts_Reallocation', col_names=TRUE))

poisson05 = data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Poisson', col_names=TRUE))
zipf05 = data.frame(read_excel("../dataAnalysis/data/instance_zipf080.xlsx", sheet='Zipf', col_names=TRUE))
times05 <- read.table("../dataAnalysis/data/instance_zipf080.dat", header = TRUE)

# alpha 0
server_use0 <- data.frame(read_excel("../dataAnalysis/data/instance_4_0.xlsx", sheet='Server_Use', col_names=TRUE))
rate_admission0 <- data.frame(read_excel("../dataAnalysis/data/instance_4_0.xlsx", sheet='Rate_Admission', col_names=TRUE))
scattering_optic0 <- data.frame(read_excel("../dataAnalysis/data/instance_4_0.xlsx", sheet='Scattering_Optic', col_names=TRUE))
scattering_wireless0 <- data.frame(read_excel("../dataAnalysis/data/instance_4_0.xlsx", sheet='Scattering_Wireless', col_names=TRUE))
load_links_optic0 <- data.frame(read_excel("../dataAnalysis/data/instance_4_0.xlsx", sheet='Load_Links_Optic', col_names=TRUE))
load_links_wireless0 <- data.frame(read_excel("../dataAnalysis/data/instance_4_0.xlsx", sheet='Load_Links_Wireless', col_names=TRUE))
path_Realloc0 = data.frame(read_excel("../dataAnalysis/data/instance_4_0.xlsx", sheet='Paths_Reallocation', col_names=TRUE))
host_Realloc0 = data.frame(read_excel("../dataAnalysis/data/instance_4_0.xlsx", sheet='Hosts_Reallocation', col_names=TRUE))

poisson0 = data.frame(read_excel("../dataAnalysis/data/instance_4_0.xlsx", sheet='Poisson', col_names=TRUE))
zipf0 = data.frame(read_excel("../dataAnalysis/data/instance_4_0.xlsx", sheet='Zipf', col_names=TRUE))
times0 <- read.table("../dataAnalysis/data/instance_4_0.dat", header = TRUE)



zipf = c(0.56,080)

lambda <- 5
n <- 100
beta <- 0.2

bs <- unique(server_use05$BS)
server_use_bs_by_n1 <- matrix(ncol=n)
server_use_bs_by_n05 <- matrix(ncol=n)
server_use_bs_by_n0 <- matrix(ncol=n)

```
### Parâmetros

alfa igual a $1$ significa distribuição zipf 0.80, o alfa igual a $0$ significa distribuição zipf 0.56.

          Parâmetros      | Valores
    ----------------------|----------
    alfa zip              | `r zipf` 
    lambda                | `r lambda`
    n                     | `r n`
    beta                  | `r beta`
    BS                    | `r length(bs)`
    Cache                 | 100
    UE                    | 200
    Storage               | MBS 32GB SBS 16GB
    Average               | MBS 300 SBS 70
    RTT inicial           | CS/MBS 0.01s(10ms) MBS/MBS 0.001s(1ms) MBS/SBS 0.0015s(1.5ms) SBS/UE 0.002s(2ms)
    Tempo da Requisição   | 10 eventos
    Mobilidade            | -2,2 unidades de distância
    
    
### Informações da Aplicação.

      Vazão Mínima |     Tamanho da Cache        | 
    ---------------|-----------------------------|
       45 Mbps     |      4GB/4000MB (32000Mb)   |
     
   
### Tempo de execução da otimização.

```{r echo=FALSE, message=FALSE, results=FALSE, warning=FALSE}
max_time1 <- max(times1$times)
times.optimize1 <- times1$times[times1$times != max_time1]
events1 <- c(1:length(times.optimize1))
times_df1 <- data.frame(events1,times.optimize1)

max_time05 <- max(times05$times)
times.optimize05 <- times05$times[times05$times != max_time05]
events05 <- c(1:length(times.optimize05))
times_df05 <- data.frame(events05,times.optimize05)

max_time0 <- max(times0$times)
times.optimize0 <- times0$times[times0$times != max_time0]
events0 <- c(1:length(times.optimize0))
times_df0 <- data.frame(events0,times.optimize0)

plot(type = "l",times_df1,col="blue",xlab = "Requests",ylab = "Time Execution")
lines(times_df05,col="red")
#lines(times_df0,col="green")
legend(x = "bottomright", 
       legend = c("alpha = 0.56", "alpha = 0.80"), 
       col = c("blue","red"), 
       horiz = F ,
       lty = 1,
       lwd = 3, 
       bty = "n")

```


### Distribuição das Requisições.


```{r echo=FALSE, warning=FALSE, results=FALSE, message=FALSE}
#par(mflow= c(2,3))
hist(poisson1$Qtd_Requests, freq=F, col=c(rgb(0,0,1,0.5)))
#hist(poisson05$Qtd_Requests, freq=F, col=c(rgb(0,0,1,0.5)))
#hist(poisson0$Qtd_Requests, freq=F, col=c(rgb(0,0,1,0.5)))
#lines(density(poisson1$Qtd_Requests))
```

### Distribuição de popularidade do conteúdo solicitado.

```{r echo=FALSE, message=FALSE, results=TRUE, warning=FALSE}
zipf1 <- count(zipf1, "Caches")
zipf1 <- zipf1[order(zipf1$freq,decreasing = TRUE),]
zipf05 <- count(zipf05, "Caches")
zipf05 <- zipf05[order(zipf05$freq,decreasing = TRUE),]
zipf0 <- count(zipf0, "Caches")
zipf0 <- zipf0[order(zipf0$freq,decreasing = TRUE),]
hist(zipf1$freq,breaks = "FD" ,freq=F,col=c(rgb(0,0,1,0.5)))
#hist(zipf05$freq,breaks = "FD" ,freq=F,col=c(rgb(0,0,1,0.5)))
#hist(zipf0$freq,breaks = "FD" ,freq=F,col=c(rgb(0,0,1,0.5)))
#par(mflow= c(1,1))
```
   
    
### Taxa de requisições alocadas.

$\alpha : 1 =$ `r  round(rate_admission1$Rate_Admission,4) * 100`% -  `r rate_admission1$Admission_Requests`/`r rate_admission1$All_Requests`.

$\alpha : 0.5 =$ `r  round(rate_admission05$Rate_Admission,4) * 100`% -  `r rate_admission05$Admission_Requests`/`r rate_admission05$All_Requests`.


### Tipos de uso de servidor por evento.
    
```{r echo=FALSE, message=FALSE, results=FALSE, warning=FALSE}
x1 <- c()
x05 <- c()
x0 <- c()

for(i in bs){
  for(j in 1:n){
    server_use_bs1 <- server_use1 %>% filter(server_use1$BS == i)
    server_use_bs05 <- server_use05 %>% filter(server_use05$BS == i)
    server_use_bs0 <- server_use0 %>% filter(server_use0$BS == i)
    server_use_n1 <-  server_use_bs1 %>% filter(server_use_bs1$Event == j)
    server_use_n05 <-  server_use_bs05 %>% filter(server_use_bs05$Event == j)
    server_use_n0 <-  server_use_bs0 %>% filter(server_use_bs0$Event == j)
    server_use_n_last1 <- server_use_n1$Use
    server_use_n_last05 <- server_use_n05$Use
    server_use_n_last0 <- server_use_n0$Use
    x1 <- append(x1,server_use_n_last1)
    x05 <- append(x05,server_use_n_last05)
    x0 <- append(x0,server_use_n_last0)
  }
  server_use_bs_by_n1 <- rbind(server_use_bs_by_n1,x1)
  server_use_bs_by_n05 <- rbind(server_use_bs_by_n05,x05)
  server_use_bs_by_n0 <- rbind(server_use_bs_by_n0,x0)
  x1 <- NULL
  x05 <- NULL
  x0 <- NULL
}
server_use_bs_by_n1 <- server_use_bs_by_n1[-1,]
server_use_bs_by_n05 <- server_use_bs_by_n05[-1,]
server_use_bs_by_n0 <- server_use_bs_by_n0[-1,]
row.names(server_use_bs_by_n1) <- bs
row.names(server_use_bs_by_n05) <- bs
row.names(server_use_bs_by_n0) <- bs
#print(server_use_bs_by_n1[,99])
# par(mflow= c(1,3))
# barplot(server_use_bs_by_n1,xlab = "Events")
# barplot(server_use_bs_by_n05,xlab = "Events")
# barplot(server_use_bs_by_n0,xlab = "Events")
# par(mflow= c(1,1))
# Grouped barplot
#barplot(server_use_bs_by_n, col=colors()[c(23,89,12)] , border="white", font.axis=2,beside=T,legend=rownames(bs), xlab="BS",font.lab=2)

#hist(server_use1$Use,freq=F,breaks=10)
#lines(density(server_use1$Use))
#hist(server_use05$Use,freq=F,breaks=10)
#lines(density(server_use05$Use))
#hist(server_use0$Use,freq=F,breaks=10)
#lines(density(server_use0$Use))
```



### Carga média de enlaces sem ópticos por evento.
```{r echo=FALSE, results=TRUE}
o_load_links_means1 <- c()
o_load_links_means05 <- c()
o_load_links_means0 <- c()

o_load_links_median1 <- c()
o_load_links_median05 <- c()
o_load_links_median0 <- c()

o_load_links_sd1 <- c()
o_load_links_sd05 <- c()
o_load_links_sd0 <- c()


for (i in 1:n){
  
  o_load_links_n1 <- load_links_optic1 %>% filter(load_links_optic1$Event == i)
  o_load_links_n05 <- load_links_optic05 %>% filter(load_links_optic05$Event == i)
  o_load_links_n0 <- load_links_optic0 %>% filter(load_links_optic0$Event == i)
  #hist(load_links_n1$Total_Load)

  o_mean1 <- mean(o_load_links_n1$Total_Load)
  o_mean05 <- mean(o_load_links_n05$Total_Load)
  o_mean0 <- mean(o_load_links_n0$Total_Load)
  
  o_median1 <-  median(o_load_links_n1$Total_Load)
  o_median05 <- median(o_load_links_n05$Total_Load)
  o_median0 <-  median(o_load_links_n0$Total_Load)
  
  o_sd1 <- sd(o_load_links_n1$Total_Load)
  o_sd05 <- sd(o_load_links_n05$Total_Load)
  o_sd0 <- sd(o_load_links_n0$Total_Load)
  
  o_load_links_means1 = append(o_load_links_means1,o_mean1)
  o_load_links_means05 = append(o_load_links_means05,o_mean05)
  o_load_links_means0 = append(o_load_links_means0,o_mean0)
  
  o_load_links_median1 = append(o_load_links_median1,o_median1)
  o_load_links_median05 = append(o_load_links_median05,o_median05)
  o_load_links_median0 = append(o_load_links_median0,o_median0)
  
  o_load_links_sd1 = append(o_load_links_sd1,o_sd1)
  o_load_links_sd05 = append(o_load_links_sd05,o_sd05)
  o_load_links_sd0 = append(o_load_links_sd0,o_sd0)
}

o_load_links_means1 <- na.omit(o_load_links_means1)
o_load_links_means05 <- na.omit(o_load_links_means05)
o_load_links_means0 <- na.omit(o_load_links_means0)

o_load_links_median1 <- na.omit(o_load_links_median1)
o_load_links_median05 <- na.omit(o_load_links_median05)
o_load_links_median0 <- na.omit(o_load_links_median0)

o_load_links_sd1 <- na.omit(o_load_links_sd1)
o_load_links_sd05 <- na.omit(o_load_links_sd05)
o_load_links_sd0 <- na.omit(o_load_links_sd0)

o_sd_top1 <- o_load_links_means1+o_load_links_sd1
o_sd_bottom1 <- o_load_links_means1-o_load_links_sd1
o_sd_top05 <- o_load_links_means05+o_load_links_sd05
o_sd_bottom05 <- o_load_links_means05-o_load_links_sd05
o_sd_top0 <- o_load_links_means0+o_load_links_sd0
o_sd_bottom0 <- o_load_links_means0-o_load_links_sd0

summary(o_load_links_means1)
summary(o_load_links_means05)
summary(o_load_links_means0)

summary(o_load_links_median1)
summary(o_load_links_median05)
summary(o_load_links_median0)


plot(o_load_links_means1, type="l",xlab = "Events",ylab = "Average Links Load ",col="blue",ylim=c(0,500))
lines(o_sd_top1,col="#4682B4")
lines(o_sd_bottom1,col="#4682B4")
lines(o_sd_top05,col="#B22222")
lines(o_sd_bottom05,col="#B22222")
#lines(o_sd_top0,col="#339966")
#lines(o_sd_bottom0,col="#339966")
lines(o_load_links_means05,col="red")
#lines(o_load_links_means0,col="green")
legend(x = "topleft", 
       legend = c("alpha = 0.56", "alpha = 0.80"), 
       col = c("blue","red"), 
       horiz = F,
       lty = 1,
       lwd = 3, 
       bty = "n")
title(main = "Carga média entre enlaces ópticos")

# plot(o_load_links_median1, type="l",xlab = "Events",ylab = "Average Links Load ",col="blue")
# lines(sd_top1,col="#4682B4")
# lines(sd_bottom1,col="#4682B4")
# lines(sd_top05,col="#B22222")
# lines(sd_bottom05,col="#B22222")
# lines(sd_top0,col="#339966")
# lines(sd_bottom0,col="#339966")
# lines(o_load_links_median05,col="red")
# lines(o_load_links_median0,col="green")
# legend(x = "topleft", 
#        legend = c("alpha = 0.56", "alpha = 0.80"), 
#        col = c("blue","red"), 
#        horiz = F,
#        lty = 1,
#        lwd = 3, 
#        bty = "n")
# title(main = "Carga mediana entre enlaces ópticos")

o_p_mean_1_05 <- t.test(o_load_links_means1,o_load_links_means05, paired = FALSE)$p.value
o_p_mean_1_0 <- t.test(o_load_links_means1,o_load_links_means0, paired = FALSE)$p.value
o_p_mean_05_0 <- t.test(o_load_links_means05,o_load_links_means0, paired = FALSE)$p.value

o_p_median_1_05 <- t.test(o_load_links_median1,o_load_links_median05, paired = FALSE)$p.value
o_p_median_1_0 <- t.test(o_load_links_median1,o_load_links_median0, paired = FALSE)$p.value
o_p_median_05_0 <-t.test(o_load_links_median05,o_load_links_median0, paired = FALSE)$p.value
```

### Significância entre amostras (Teste T não pareado).

*Um valor de p menor que 0.05 indica que a diferença é estatisticamente significativa.*

**Entre médias:**


A diferença entre alfa 1 e alfa 0.5 **é** estatisticamente significativa. Valor de p: `r o_p_mean_1_05`.



**Entre medianas:**


A diferença entre alfa 1 e alfa 0.5 **é** estatisticamente significativa. Valor de p: `r o_p_mean_1_05`.


### Número de Realocação de Enlaces por Evento

```{r echo=FALSE, results=FALSE}

path_Realloc1_count_event <- count(path_Realloc1, "Event")
path_Realloc05_count_event <- count(path_Realloc05, "Event")
path_Realloc0_count_event <- count(path_Realloc0, "Event")

plot(path_Realloc1_count_event$freq, type="l", col="blue",xlab = "Events",ylab = "Path Reallocation", ylim = c(min(path_Realloc0_count_event$freq),max(path_Realloc1_count_event$freq)))
lines(path_Realloc05_count_event$freq,col="red")
#lines(path_Realloc0_count_event$freq,col="green")
legend(x = "topleft",
       legend = c("alpha = 0.56", "alpha = 0.80"), 
       col = c("blue","red"),
       horiz = F ,
       lty = 1,
       lwd = 3,
       bty = "n"
        )

p_1_05 <- t.test(path_Realloc1_count_event$freq,path_Realloc05_count_event$freq, paired = FALSE)$p.value
p_1_0 <- t.test(path_Realloc1_count_event$freq,path_Realloc0_count_event$freq, paired = FALSE)$p.value
p_05_0 <- t.test(path_Realloc05_count_event$freq,path_Realloc0_count_event$freq, paired = FALSE)$p.value
```

### Significância entre amostras (Teste T não pareado).

*Um valor de p menor que 0.05 indica que a diferença é estatisticamente significativa.*

A diferença entre alfa 1 e alfa 0.5 **é** estatisticamente significativa. Valor de p: `r p_1_05`.


### Número de Realocação de Servidor por Evento

```{r echo=FALSE, results=FALSE}
host_Realloc1_count_event <- count(host_Realloc1, "Event")
host_Realloc05_count_event <- count(host_Realloc05, "Event")
host_Realloc0_count_event <- count(host_Realloc0, "Event")

plot(host_Realloc1_count_event$freq, type="l", col="blue",xlab = "Events",ylab = "Host Reallocation", ylim = c(min(host_Realloc1_count_event$freq),max(host_Realloc0_count_event$freq)))
lines(host_Realloc05_count_event$freq,col="red")
#lines(host_Realloc0_count_event$freq,col="green")
legend(x = "topright",
       legend = c("alpha = 0.56", "alpha = 0.80"), 
       col = c("blue","red"),
       horiz = F ,
       lty = 1,
       lwd = 3,
       bty = "n"
      )

p_1_05 <- t.test(host_Realloc1_count_event$freq,host_Realloc05_count_event$freq, paired = FALSE)$p.value
p_1_0 <- t.test(host_Realloc1_count_event$freq,host_Realloc0_count_event$freq, paired = FALSE)$p.value
p_05_0 <- t.test(host_Realloc05_count_event$freq,host_Realloc0_count_event$freq, paired = FALSE)$p.value
```

### Significância entre amostras (Teste T não pareado).

*Um valor de p menor que 0.05 indica que a diferença é estatisticamente significativa.*

A diferença entre alfa 1 e alfa 0.5  **não é** estatisticamente significativa. Valor de p: `r p_1_05`.


### Testes de Correlação Kendall

*Um valor de p próximo de 0 indica fraca correlação e próximo a 1 forte correlação.*

```{r echo=FALSE, results=FALSE}

p_host_path <- cor(host_Realloc1_count_event$freq, path_Realloc1_count_event$freq, method = "kendall")
o_p_links_path <- cor(o_load_links_means1, path_Realloc1_count_event$freq, method = "kendall")
o_p_links_host <- cor(o_load_links_means1, host_Realloc1_count_event$freq, method = "kendall")

```
**Correlação entre migração de servidores e caminhos.** Valor de p: `r p_host_path`.

Correlação entre carga média dos enlaces ópticos e migração de caminhos.  Valor de p: `r o_p_links_path`.

Correlação entre carga média dos enlaces ópticos e migração de servidores.  Valor de p: `r o_p_links_host`.